#include "benchmark/benchmark.h"
#include "util/unify.hpp"

static void BM_UniFyParse(benchmark::State& state)
{
    using   U8ToU16 = util::UniFy<char16_t, char8_t>;
    char16_t uc_data[1040 * 10] = {0,};
    char data[] = "\"24900\"], [\"6831.08\", \"3.01988604\"], [\"6831.59\", \"6.00000000\"], [\"6831.77\", \"5.12427499\"], [\"6832.00\", \"0.05000000\"], [\"6832.29\", \"11.71783000\"], [\"6836.89\", \"2.19081260\"], [\"6839.78\", \"6.00000000\"], [\"6840.19\", \"1.80999410\"], [\"6840.95\", \"11.90568200\"], [\"6841.89\", \"4.90391520\"], [\"6843.39\", \"9.10100000\"], [\"6845.00\", \"0.27750000\"], [\"6847.99\", \"6.00000000\"], [\"6848.01\", \"0.00650890\"], [\"6848.53\", \"5.77630909\"], [\"6848.54\", \"29.19590000\"], [\"6850.49\", \"0.01000000\"], [\"6850.54\", \"11.92730000\"], [\"6851.00\", \"0.12374728\"], [\"6851.78\", \"1.40623455\"], [\"6852.27\", \"4.62898232\"], [\"6856.19\", \"0.28285714\"], [\"6856.20\", \"0.04412917\"], [\"6856.21\", \"5.95226765\"], [\"6857.20\", \"0.01000000\"], [\"6857.61\", \"0.00521961\"], [\"6859.32\", \"13.49000000\"], [\"6860.00\", \"0.09389520\"], [\"6862.00\", \"0.05000000\"], [\"6863.33\", \"4.99187477\"], [\"6863.77\", \"0.00000031\"], [\"6864.44\", \"6.00000000\"], [\"6865.50\", \"0.60194138\"], [\"6866.96\", \"0.25466413\"], [\"6867.00\", \"0.00571154\"], [\"6867.83\", \"15.17111600\"], [\"6868.21\", \"0.00648976\"], [\"6872.67\", \"6.00000000\"], [\"6872.84\", \"9.01400000\"], [\"6876.74\", \"14.70000000\"], [\"6878.00\", \"0.50000000\"], [\"6880.00\", \"0.16607545\"], [\"6880.30\", \"0.65173508\"], [\"6880.92\", \"6.00000000\"], [\"6886.47\", \"0.48400000\"], [\"6886.97\", \"10.90826911\"], [\"6888.41\", \"0.00647073\"], [\"6888.88\", \"0.01240964\"], [\"6889.00\", \"0.10000000\"], [\"6889.18\", \"6.00000000\"], [\"6890.00\", \"0.02214790\"], [\"6891.50\", \"11.54610000\"]]}, \"event\": \"data\", \"channel\": \"order_book_btcusd\"}, \"6.00000000\"], [\"6872.84\", \"9.01400000\"], [\"6876.74\", \"14.70000000\"], [\"6878.00\", \"0.50000000\"], [\"6880.00\", \"0.16607545\"], [\"6880.30\", \"0.65173508\"], [\"6880.92\", \"6.00000000\"], [\"6886.47\", \"0.48400000\"], [\"6886.97\", \"10.90826911\"], [\"6888.41\", \"0.00647073\"], [\"6888.88\", \"0.01240964\"], [\"6889.00\", \"0.10000000\"], [\"6889.18\", \"6.00000000\"], [\"6890.00\", \"0.02214790\"], [\"6891.50\", \"11.54610000\"]]}, \"event\": \"data\", \"channel\": \"order_book_btcusd\"}";

    for (auto _ : state)
    {
        //auto [size, length] = U8ToU16::transcode(uc_data, reinterpret_cast<const char8_t*>("This is a test"), 14);
        auto [size, length] = U8ToU16::transcode(uc_data, reinterpret_cast<char8_t*>(data), sizeof(data));
        (void) size;
        (void) length;
    }

}

// Register the function as a benchmark
BENCHMARK(BM_UniFyParse);

BENCHMARK_MAIN();
